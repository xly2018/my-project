{
  "filename": "pdf导出.md",
  "__html": "<h3>添加maven依赖</h3>\n<pre><code class=\"language-xml\">   <span class=\"hljs-comment\">&lt;!-- pdfHTML --&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.itextpdf<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>html2pdf<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.0.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n        <span class=\"hljs-comment\">&lt;!-- add all iText 7 Community modules --&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.itextpdf<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>itext7-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>7.0.5<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>pom<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-comment\">&lt;!-- freemarker engine --&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.freemarker<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>freemarker<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.3.28<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h3>freemaker根据模板生成html</h3>\n<p><code>FreeMarkerUtils.htmHandler(templatePath, templateName, htmlUrl, map);</code></p>\n<pre><code class=\"language-java\">  <span class=\"hljs-comment\">/**\n     * <span class=\"hljs-doctag\">@param</span> templatePath 模板路径\n     * <span class=\"hljs-doctag\">@param</span> templateName 模板名称\n     * <span class=\"hljs-doctag\">@param</span> htmUrl       html页面全路径\n     * <span class=\"hljs-doctag\">@param</span> paramMap     渲染ftl的数据模型\n     * <span class=\"hljs-doctag\">@throws</span> Exception\n     * <span class=\"hljs-doctag\">@author</span> xly\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">htmHandler</span><span class=\"hljs-params\">(String templatePath, String templateName,\n                                  String htmUrl, Map&lt;String, Object&gt; paramMap)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>{\n        Configuration cfg = <span class=\"hljs-keyword\">new</span> Configuration(Configuration.VERSION_2_3_28);\n        <span class=\"hljs-comment\">//设置字符编码</span>\n        cfg.setDefaultEncoding(<span class=\"hljs-string\">\"UTF-8\"</span>);\n        <span class=\"hljs-comment\">//设置模板加载路径</span>\n        cfg.setDirectoryForTemplateLoading(<span class=\"hljs-keyword\">new</span> File(templatePath));\n        <span class=\"hljs-comment\">//获取模板</span>\n        Template template = cfg.getTemplate(templateName);\n        <span class=\"hljs-comment\">//构建html文件</span>\n        File outHtmFile = <span class=\"hljs-keyword\">new</span> File(htmUrl);\n        <span class=\"hljs-comment\">//写出html文件</span>\n        Writer out = <span class=\"hljs-keyword\">new</span> BufferedWriter(<span class=\"hljs-keyword\">new</span> OutputStreamWriter(\n                <span class=\"hljs-keyword\">new</span> FileOutputStream(outHtmFile), <span class=\"hljs-string\">\"UTF-8\"</span>));\n        template.process(paramMap, out);\n\n        out.close();\n    }\n</code></pre>\n<h3>html2pdf</h3>\n<pre><code class=\"language-java\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">html2pdf</span><span class=\"hljs-params\">(String htmlUrl, String pdfName)</span> <span class=\"hljs-keyword\">throws</span> IOException </span>{\n        File htmlSource = <span class=\"hljs-keyword\">new</span> File(htmlUrl);\n        FileInputStream inputStream = <span class=\"hljs-keyword\">new</span> FileInputStream(htmlSource);\n        String pdfPath = FreeMarkerUtils.getTemplatePath(<span class=\"hljs-string\">\"pdf\"</span>);\n        FileUtils.createDirectory(pdfPath);\n        <span class=\"hljs-comment\">//声明输出流</span>\n        FileOutputStream fileOutputStream = <span class=\"hljs-keyword\">new</span> FileOutputStream(pdfPath + pdfName + <span class=\"hljs-string\">\".pdf\"</span>);\n        <span class=\"hljs-comment\">//写入流信息</span>\n        fileOutputStream.write(Html2PdfUtil.convert(inputStream));\n        fileOutputStream.close();\n    }\n</code></pre>\n<h3>压缩文件夹打包zip导出</h3>\n<pre><code class=\"language-java\">\t<span class=\"hljs-comment\">/**\n\t * 压缩成ZIP 方法1\n\t * <span class=\"hljs-doctag\">@author</span> xly\n\t * <span class=\"hljs-doctag\">@param</span> srcDir           压缩文件夹路径\n\t * <span class=\"hljs-doctag\">@param</span> out              压缩文件输出流\n\t * <span class=\"hljs-doctag\">@param</span> KeepDirStructure 是否保留原来的目录结构,true:保留目录结构;\n\t *                         false:所有文件跑到压缩包根目录下(注意：不保留目录结构可能会出现同名文件,会压缩失败)\n\t * <span class=\"hljs-doctag\">@throws</span> RuntimeException 压缩失败会抛出运行时异常\n\t */</span>\n\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">toZip</span><span class=\"hljs-params\">(String srcDir, OutputStream out, <span class=\"hljs-keyword\">boolean</span> KeepDirStructure)</span>\n\t\t\t<span class=\"hljs-keyword\">throws</span> RuntimeException </span>{\n\n\t\t<span class=\"hljs-keyword\">long</span> start = System.currentTimeMillis();\n\t\tZipOutputStream zos = <span class=\"hljs-keyword\">null</span>;\n\t\t<span class=\"hljs-keyword\">try</span> {\n\t\t\tzos = <span class=\"hljs-keyword\">new</span> ZipOutputStream(out);\n\t\t\tFile sourceFile = <span class=\"hljs-keyword\">new</span> File(srcDir);\n\t\t\tcompress(sourceFile, zos, sourceFile.getName(), KeepDirStructure);\n\t\t\t<span class=\"hljs-keyword\">long</span> end = System.currentTimeMillis();\n\t\t\tSystem.out.println(<span class=\"hljs-string\">\"压缩完成，耗时：\"</span> + (end - start) + <span class=\"hljs-string\">\" ms\"</span>);\n\t\t} <span class=\"hljs-keyword\">catch</span> (Exception e) {\n\t\t\t<span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> RuntimeException(<span class=\"hljs-string\">\"zip error from ZipUtils\"</span>, e);\n\t\t} <span class=\"hljs-keyword\">finally</span> {\n\t\t\t<span class=\"hljs-keyword\">if</span> (zos != <span class=\"hljs-keyword\">null</span>) {\n\t\t\t\t<span class=\"hljs-keyword\">try</span> {\n\t\t\t\t\tzos.close();\n\t\t\t\t} <span class=\"hljs-keyword\">catch</span> (IOException e) {\n\t\t\t\t\te.printStackTrace();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n</code></pre>\n<h3>前端导出进度展示</h3>\n<p>html 页面</p>\n<pre><code class=\"language-html\"> <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span> <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">\"stylesheet\"</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"${ctxStatic}/components/jquery-circliful/css/jquery.circliful.css\"</span>/&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text/javascript\"</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"${ctxStatic}/components/jquery-circliful/js/jquery.circliful.js\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n  \n  \n  <span class=\"hljs-comment\">&lt;!-- Mask是遮罩，Progress是进度条 --&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"Mask\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"Progress\"</span> <span class=\"hljs-attr\">data-dimension</span>=<span class=\"hljs-string\">\"200\"</span> <span class=\"hljs-attr\">data-text</span>=<span class=\"hljs-string\">\"0%\"</span> <span class=\"hljs-attr\">data-info</span>=<span class=\"hljs-string\">\"导出进度\"</span> <span class=\"hljs-attr\">data-width</span>=<span class=\"hljs-string\">\"15\"</span> <span class=\"hljs-attr\">data-fontsize</span>=<span class=\"hljs-string\">\"30\"</span>\n         <span class=\"hljs-attr\">data-percent</span>=<span class=\"hljs-string\">\"0\"</span> <span class=\"hljs-attr\">data-fgcolor</span>=<span class=\"hljs-string\">\"##6633CC\"</span> <span class=\"hljs-attr\">data-bgcolor</span>=<span class=\"hljs-string\">\"#eee\"</span> <span class=\"hljs-attr\">data-fill</span>=<span class=\"hljs-string\">\"#ddd\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n</code></pre>\n<p>js</p>\n<pre><code class=\"language-js\">jseasyui.exam.examperiod.main.count;\njseasyui.exam.examperiod.main.batchDownload = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n    <span class=\"hljs-comment\">//校验</span>\n    <span class=\"hljs-keyword\">var</span> schoolYear = $(<span class=\"hljs-string\">'#schoolYear'</span>).val();\n    <span class=\"hljs-keyword\">var</span> schoolTerm = $(<span class=\"hljs-string\">'#schoolTerm'</span>).val();\n    <span class=\"hljs-keyword\">var</span> examType = $(<span class=\"hljs-string\">'#testType'</span>).val();\n    <span class=\"hljs-keyword\">if</span> (schoolYear == <span class=\"hljs-string\">''</span>) {\n        jseasyui.tips(<span class=\"hljs-string\">'提示'</span>, <span class=\"hljs-string\">\"请选择学年！\"</span>, <span class=\"hljs-number\">5</span>);\n        <span class=\"hljs-keyword\">return</span>;\n    }\n    <span class=\"hljs-keyword\">if</span> (schoolTerm == <span class=\"hljs-string\">''</span>) {\n        jseasyui.tips(<span class=\"hljs-string\">'提示'</span>, <span class=\"hljs-string\">\"请选择学期！\"</span>, <span class=\"hljs-number\">5</span>);\n        <span class=\"hljs-keyword\">return</span>;\n    }\n    <span class=\"hljs-keyword\">if</span> (examType == <span class=\"hljs-string\">''</span>) {\n        jseasyui.tips(<span class=\"hljs-string\">'提示'</span>, <span class=\"hljs-string\">\"请选择考试类型！\"</span>, <span class=\"hljs-number\">5</span>);\n        <span class=\"hljs-keyword\">return</span>;\n    }\n    <span class=\"hljs-keyword\">var</span> param = {\n        <span class=\"hljs-attr\">schoolYear</span>: schoolYear,\n        <span class=\"hljs-attr\">schoolTerm</span>: schoolTerm,\n        <span class=\"hljs-attr\">examType</span>: examType\n    };\n    <span class=\"hljs-keyword\">var</span> asyncParam = {\n        <span class=\"hljs-attr\">async</span>: <span class=\"hljs-literal\">false</span>\n    };\n    <span class=\"hljs-keyword\">var</span> count;\n    jseasyui.ajaxJson(<span class=\"hljs-string\">'excel/getTotalCount'</span>, param, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">data</span>) </span>{\n        count = data.data;\n    }, asyncParam);\n    <span class=\"hljs-keyword\">if</span> (count == <span class=\"hljs-number\">0</span>) {\n        jseasyui.tips(<span class=\"hljs-string\">'提示'</span>, <span class=\"hljs-string\">\"没有找到数据！\"</span>, <span class=\"hljs-number\">5</span>);\n    } <span class=\"hljs-keyword\">else</span> {\n        <span class=\"hljs-comment\">//导出</span>\n        <span class=\"hljs-built_in\">window</span>.location.href = <span class=\"hljs-string\">'excel/exportZip?schoolYear='</span> + schoolYear + <span class=\"hljs-string\">'&amp;schoolTerm='</span> + schoolTerm + <span class=\"hljs-string\">'&amp;examType='</span> + examType;\n        <span class=\"hljs-comment\">/*** 进度条的显示  */</span>\n        jseasyui.exam.examperiod.main.showProgress();\n        jseasyui.exam.examperiod.main.timer();\n        isFirstExport = <span class=\"hljs-literal\">false</span>;\n    }\n}\n<span class=\"hljs-comment\">/**\n * 定时器 刷新进度\n */</span>\njseasyui.exam.examperiod.main.timer = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n    <span class=\"hljs-built_in\">window</span>.setTimeout(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n        <span class=\"hljs-keyword\">var</span> timer = <span class=\"hljs-built_in\">window</span>.setInterval(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n            jseasyui.ajaxJson(<span class=\"hljs-string\">'excel/flushProgress'</span>, {}, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">data</span>) </span>{\n                $(<span class=\"hljs-string\">\"#Progress .circle-text\"</span>).text(data.data.percentText);\n                $(<span class=\"hljs-string\">\"#Progress .circle-info\"</span>).text(<span class=\"hljs-string\">\"导出进度:\"</span> + data.data.curCount + <span class=\"hljs-string\">\"/\"</span> + data.data.totalCount);\n                <span class=\"hljs-keyword\">if</span> (data.data.percent == <span class=\"hljs-string\">\"100\"</span>) {\n                    <span class=\"hljs-built_in\">window</span>.clearInterval(timer);\n                    jseasyui.exam.examperiod.main.hideProgress();\n                }\n            })\n        }, <span class=\"hljs-number\">800</span>);\n    }, <span class=\"hljs-number\">800</span>);\n}\n<span class=\"hljs-comment\">//显示进度条</span>\n<span class=\"hljs-keyword\">var</span> isFirstExport = <span class=\"hljs-literal\">true</span>;\njseasyui.exam.examperiod.main.showProgress = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n    $(<span class=\"hljs-string\">\"#Mask\"</span>).css(<span class=\"hljs-string\">\"height\"</span>, $(<span class=\"hljs-built_in\">document</span>).height());\n    $(<span class=\"hljs-string\">\"#Mask\"</span>).css(<span class=\"hljs-string\">\"width\"</span>, $(<span class=\"hljs-built_in\">document</span>).width());\n    $(<span class=\"hljs-string\">\"#Mask\"</span>).show();\n    <span class=\"hljs-keyword\">if</span> (isFirstExport) {\n        $(<span class=\"hljs-string\">\"#Progress\"</span>).circliful();\n    } <span class=\"hljs-keyword\">else</span> {\n        $(<span class=\"hljs-string\">\"#Progress .circle-text\"</span>).text(<span class=\"hljs-string\">\"0%\"</span>);\n        $(<span class=\"hljs-string\">\"#Progress .circle-info\"</span>).text(<span class=\"hljs-string\">\"导出进度\"</span>);\n        $(<span class=\"hljs-string\">\"#Progress\"</span>).show();\n    }\n}\n<span class=\"hljs-comment\">//隐藏进度条</span>\njseasyui.exam.examperiod.main.hideProgress = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n    $(<span class=\"hljs-string\">\"#Mask\"</span>).hide();\n    $(<span class=\"hljs-string\">\"#Progress\"</span>).hide();\n}\n</code></pre>\n<h3>效果</h3>\n<p><img src=\"https://xly2018.github.io/long/img/a6848d34.gif\" alt=\"\"></p>\n",
  "link": "\\zh-cn\\blog\\pdf导出.html",
  "meta": {
    "title": "freemaker+itext pdf导出网页",
    "date": "2019-07-23",
    "tags": "",
    "- pdf": ""
  }
}